/*******************************************************
 *  AUTOMATIC POETRY SENDER โ FIFTH POEM (YOUR UI)
 *  - Uses ChatGPT ProseMirror Editor (#prompt-textarea)
 *  - Sends one full verse (ุตุฏุฑ + ุนุฌุฒ) every 20 seconds
 *  - Stop anytime using: window.stopScript = true;
 *******************************************************/

window.stopScript = false;

const poem = [
"ููุฏูู ุงูุชููุฆูุจ ุฃูุฑุจููุชู ูู ุงูุบูููุงุกู    ููู ุชูุนุฐููููู ููุฃููุชููู ุณูุฌูุฑุงุฆูุ!",
"ูุง ุชูุณูููู ูุงุกู ุงููููุงูู ููุฅูููููู    ุตูุจูู ููุฏู ุงูุณุชูุนุฐูุจุชู ูุงุกู ุจููุงุฆู",
"ููููุนูุฑููุณู ูููุบููุซู ุชูุฎูููู ุจูููููู    ุฑุงูุงุชู ููููู ุฏูุฌููููุฉู ููุทูููุงุกู",
"ููุดูุฑูุช ุญูุฏุงุฆููููู ููุตูุฑูู ููุขูููุงู    ููุทูุฑุงุฆููู ุงูุฃูููุงุกู ููุงูุฃููุฏุงุกู",
"ููุณููุงูู ููุณูู ุงูุทูููู ูุงููุฑู ุงูุตูุจุง    ููุงููุญูููู ูููู ุฎููุทู ููููู ุณููุงุกู",
"ุนููููู ุงูุฑูุจูุนู ุจูุฑููุถููู ููููุฃูููููุง    ุฃููุฏู ุฅูููููู ุงูููุดูู ููู ุตููุนุงุกู",
"ุตูุจููุญุชููู ุจูุณููุงููุฉู ุตูุจููุญุชููุง    ุจูุณููุงููุฉู ุงูุฎูููุทุงุกู ููุงููููุฏูููุงุกู",
"ุจูููุฏุงููุฉู ุชูุบุฏู ุงููููู ููููุคูุณููุง    ุฎููููุงู ุนููู ุงูุณูุฑูุงุกู ููุงูุถููุฑููุงุกู",
"ุฑุงุญู ุฅูุฐุง ูุง ุงูุฑุงุญู ููููู ููุทูููููุง    ูุงููุช ููุทุงูุง ุงูุดูููู ูู ุงูุฃูุญูุดุงุกู",
"ุนูููุจููููุฉู ุฐูููุจููููุฉู ุณูููุจูุช ูููุง    ุฐูููุจู ุงูููุนุงูู ุตุงุบูุฉู ุงูุดูุนูุฑูุงุกู",
"ุฃููููู ุงูุฒููุงูู ููุทููู ูููุซู ุจููุงุฆููุง    ูุง ูุงูู ุฎุงููุฑููุง ูููู ุงูุฃูููุฐุงุกู",
"ุตูุนูุจูุช ููุฑุงุถู ุงูููุฒุฌู ุณููููุกู ุฎูููููุง    ููุชูุนููููููุช ููู ุญูุณูู ุฎูููู ุงูููุงุกู",
"ุฎูุฑูุงุกู ูููุนูุจู ุจูุงูุนููููู ุญูุจุงุจููุง    ููุชูููุนููุจู ุงูุฃููุนุงูู ุจูุงูุฃูุณููุงุกู",
"ููุถูุนูููุฉู ููุฅูุฐุง ุฃูุตุงุจูุช ููุฑุตูุฉู    ููุชูููุช ููุฐููููู ููุฏุฑูุฉู ุงูุถููุนูููุงุกู",
"ุฌูููููููุฉู ุงูุฃููุตุงูู ุฅูููุง ุฃููููููู    ููุฏ ูููููุจููุง ุฌููููุฑู ุงูุฃูุดูููุงุกู",
"ููููุฃูููู ุจููุฌูุชููุง ููุจููุฌูุฉู ููุฃุณููุง    ูุงุฑู ููููุฑู ูููููุฏูุง ุจูููุนูุงุกู",
"ุฃูู ุฏูุฑููุฉู ุจููุถุงุกู ุจููุฑู ุฃูุทุจูููุช    ุญูุจููุง ุนููู ูุงููุชูุฉู ุญูููุฑูุงุกู",
"ููููุณุงููุฉู ููููุณุงููุฉู ุงูููุฌุฑู ุงูุฑุชููู    ูู ุตูุฏุฑู ุจุงูู ุงูุญูุจูู ููุงูุจูุฑูุญูุงุกู",
"ุจูุฏู ููููุณูู ุงูุนูุฏู ูู ุฃููููุฏููุง    ูุง ุงูุฑุชูุฏู ููู ุนูุฏู ููููู ุนูุฏูููุงุกู",
"ููุฒูููุชู ุซููุจู ุนูููุจููุง ุจูุฑูููุจููุง    ููุงููููุงุฑู ุชููุจูุนู ููู ุญูุตู ุงูููุนูุฒูุงุกู",
"ููุฅููู ุงูุจูู ุญูุณูุงูู ุงูุนุชูุฏูุช ุจู ูููููุฉู    ููููููุช ุนูููููู ุฎููููุชูู ููุฅูุฎูุงุฆูู",
"ููููุง ุฑูุฃููุชููู ููุฏ ุบูุฐููุชู ููููุฏููุชู    ุจูุงูุจูุดุฑู ููุงูุณุชูุญุณููุชู ููุฌูู ุซูููุงุฆูู",
"ุฃููุจูุทุชู ูู ูููุจู ููููุฃูููู ููุดุฑูุนุงู    ุธููููุช ุชูุญููู ุนูููููู ุทููุฑู ุฑูุฌูุงุฆูู",
"ููุซููููุชู ุฌุงุฑุงู ูููุญูุถูุถู ูููููููุชู    ููุฏ ุทููููููุช ุจููููุงููุจู ุงูุฌูููุฒุงุกู",
"ุฅููู ููุฏูุชูู ููุบุงุฑูุณู ูููููุงุจูุชู    ุฅูุทุฑูุญ ุบููุงุกููู ูู ุจูุญูุฑู ุนูููุงุฆูู",
"ููุณููุฑ ููููููููู ูููุฑู ููุนูููู ุฅูููููู    ููููู ุงููุชูุถุงุถู ุตูููุนูุฉู ุนูุฐุฑูุงุกู",
"ููุฅููู ููุญููููุฏู ุงูุจุชูุนูุซุชู ููุตุงุฆูุฏู    ููุฑูููุนุชู ูููููุณุชููุดูุฏููู ููููุงุฆูู",
"ููุฅูุฐุง ุชูุดุงุฌูุฑูุชู ุงูุฎูุทูุจู ููุฑููุชููุง    ุฌูุฏููุงู ููููููู ููุถุงุฑูุจู ุงูุฃูุนูุฏุงุกู",
"ูุง ุบุงููุฉู ุงูุฃูุฏูุจุงุกู ููุงูุธูุฑููุงุกู ุจูู    ูุง ุณููููุฏู ุงูุดูุนูุฑูุงุกู ููุงูุฎูุทูุจูุงุกู",
"ููุญูู ุจูู ุซุงุจูุชู ุงูููุฐู ุณูููู ุงูููุฏู    ููุญููู ุงููููุงุฑููู ููู ุญููุงู ููุญูุงุก"
];

let i = 0;

/************** INSERT TEXT INTO CHATGPT **************/
function writeMessage(text) {
    const editor = document.querySelector("#prompt-textarea");
    if (!editor) return alert("โ Input field (#prompt-textarea) not found.");

    editor.innerHTML = `<p>${text.replace(/\n/g, "<br>")}</p>`;
    editor.dispatchEvent(new Event("input", { bubbles: true }));
    editor.focus();
}

/************** CLICK SEND BUTTON **************/
function clickSend() {
    const btn = document.querySelector("#composer-submit-button");
    if (!btn) return alert("โ Send button not found (#composer-submit-button).");
    btn.click();
}

/************** WAIT UNTIL CHATGPT FINISHES **************/
function waitForFinish(callback) {
    const observer = new MutationObserver(() => {
        const typing = document.querySelector("[data-testid='bot-typing']");
        if (!typing) {
            observer.disconnect();
            setTimeout(callback, 500);
        }
    });
    observer.observe(document.querySelector("main"), {
        childList: true,
        subtree: true
    });
}

/************** MAIN LOOP **************/
function run() {
    if (window.stopScript) {
        console.log("โ Script stopped manually.");
        return;
    }

    if (i >= poem.length) {
        console.log("๐ Finished sending all verses!");
        return;
    }

    const msg = `ุงูุจูุช ุฑูู ${i + 1}:\n${poem[i]}`;
    console.log("โก๏ธ Sending:", msg);

    writeMessage(msg);

    setTimeout(() => {
        clickSend();
        waitForFinish(run);
    }, 20000); // 20 seconds delay

    i++;
}

/************** START **************/
run();
